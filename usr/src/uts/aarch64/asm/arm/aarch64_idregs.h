/*
 * This file and its contents are supplied under the terms of the
 * Common Development and Distribution License ("CDDL"), version 1.0.
 * You may only use this file in accordance with the terms of version
 * 1.0 of the CDDL.
 *
 * A full copy of the text of the CDDL should have accompanied this
 * source.  A copy of the CDDL is also available via the Internet at
 * http://www.illumos.org/license/CDDL.
 */

/*
 * Copyright 2022 Michael van der Westhuizen
 */

#ifndef _AARCH64_IDREGS_H
#define	_AARCH64_IDREGS_H

/*
 * Accessors for aarch64 ID registers
 *
 * This file contains the primary ID registers only:
 *	Main ID
 *	Multiprocessor Affinity
 *	Memory Model Features
 *	Processor Features
 *	Debug Features
 *	Instruction Set Attributes
 */

#if !defined(_ASM)

#include <sys/types.h>
#include <sys/int_const.h>

#ifdef __cplusplus
extern "C" {
#endif

extern uint64_t read_midr_el1(void);
extern uint64_t read_mpidr_el1(void);
extern uint64_t read_id_aa64mmfr0_el1(void);
extern uint64_t read_id_aa64mmfr1_el1(void);
extern uint64_t read_id_aa64mmfr2_el1(void);
extern uint64_t read_id_aa64pfr0_el1(void);
extern uint64_t read_id_aa64pfr1_el1(void);
extern uint64_t read_id_aa64dfr0_el1(void);
extern uint64_t read_id_aa64dfr1_el1(void);
extern uint64_t read_id_aa64isar0_el1(void);
extern uint64_t read_id_aa64isar1_el1(void);
extern uint64_t read_id_aa64isar2_el1(void);

#ifdef __cplusplus
}
#endif

#if !defined(CONST64)
#define	CONST64(c)	UINT64_C(c)
#endif
#else
#if !defined(CONST64)
#define	CONST64(c)	(c)
#endif
#endif	/* !_ASM */

/*
 * Main ID Register fields
 */
#define	MIDR_EL1_IMPLEMENTER_SHIFT		24
#define	MIDR_EL1_IMPLEMENTER_MASK		CONST64(0xff)
#define	MIDR_EL1_VARIANT_SHIFT			20
#define	MIDR_EL1_VARIANT_MASK			CONST64(0xf)
#define	MIDR_EL1_ARCHITECTURE_SHIFT		16
#define	MIDR_EL1_ARCHITECTURE_MASK		CONST64(0xf)
#define	MIDR_EL1_PARTNUM_SHIFT			4
#define	MIDR_EL1_PARTNUM_MASK			CONST64(0xfff)
#define	MIDR_EL1_REVISION_SHIFT			0
#define	MIDR_EL1_REVISION_MASK			CONST64(0xf)

/*
 * Multiprocessor Affinity Register fields
 */
#define	MPIDR_EL1_AFF3_SHIFT			32
#define	MPIDR_EL1_AFF3_MASK			CONST64(0xff)
#define	MPIDR_EL1_U_SHIFT			30
#define	MPIDR_EL1_U_MASK			CONST64(0x1)
#define	MPIDR_EL1_MT_SHIFT			24
#define	MPIDR_EL1_MT_MASK			CONST64(0x1)
#define	MPIDR_EL1_AFF2_SHIFT			16
#define	MPIDR_EL1_AFF2_MASK			CONST64(0xff)
#define	MPIDR_EL1_AFF1_SHIFT			8
#define	MPIDR_EL1_AFF1_MASK			CONST64(0xff)
#define	MPIDR_EL1_AFF0_SHIFT			0
#define	MPIDR_EL1_AFF0_MASK			CONST64(0xff)

/*
 * AArch64 Memory Model Feature Register 0 fields
 */
#define	ID_AA64MMFR0_EL1_ECV_SHIFT		60
#define	ID_AA64MMFR0_EL1_ECV_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_FGT_SHIFT		56
#define	ID_AA64MMFR0_EL1_FGT_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_EXS_SHIFT		44
#define	ID_AA64MMFR0_EL1_EXS_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_TGRAN4_2_SHIFT		40
#define	ID_AA64MMFR0_EL1_TGRAN4_2_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_TGRAN64_2_SHIFT	36
#define	ID_AA64MMFR0_EL1_TGRAN64_2_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_TGRAN16_2_SHIFT	32
#define	ID_AA64MMFR0_EL1_TGRAN16_2_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_TGRAN4_SHIFT		28
#define	ID_AA64MMFR0_EL1_TGRAN4_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_TGRAN64_SHIFT		24
#define	ID_AA64MMFR0_EL1_TGRAN64_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_TGRAN16_SHIFT		20
#define	ID_AA64MMFR0_EL1_TGRAN16_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_BIGENDEL0_SHIFT	16
#define	ID_AA64MMFR0_EL1_BIGENDEL0_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_SNSMEM_SHIFT		12
#define	ID_AA64MMFR0_EL1_SNSMEM_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_BIGEND_SHIFT		8
#define	ID_AA64MMFR0_EL1_BIGEND_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_ASIDBITS_SHIFT		4
#define	ID_AA64MMFR0_EL1_ASIDBITS_MASK		CONST64(0xf)
#define	ID_AA64MMFR0_EL1_PARANGE_SHIFT		0
#define	ID_AA64MMFR0_EL1_PARANGE_MASK		CONST64(0xf)

/*
 * AArch64 Memory Model Feature Register 1 fields
 */
#define	ID_AA64MMFR1_EL1_NTLBPA_SHIFT		48
#define	ID_AA64MMFR1_EL1_NTLBPA_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_AFP_SHIFT		44
#define	ID_AA64MMFR1_EL1_AFP_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_HCX_SHIFT		40
#define	ID_AA64MMFR1_EL1_HCX_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_ETS_SHIFT		36
#define	ID_AA64MMFR1_EL1_ETS_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_TWED_SHIFT		32
#define	ID_AA64MMFR1_EL1_TWED_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_XNX_SHIFT		28
#define	ID_AA64MMFR1_EL1_XNX_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_SPECSEI_SHIFT		24
#define	ID_AA64MMFR1_EL1_SPECSEI_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_PAN_SHIFT		20
#define	ID_AA64MMFR1_EL1_PAN_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_LO_SHIFT		16
#define	ID_AA64MMFR1_EL1_LO_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_HPDS_SHIFT		12
#define	ID_AA64MMFR1_EL1_HPDS_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_VH_SHIFT		8
#define	ID_AA64MMFR1_EL1_VH_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_VMIDBITS_SHIFT		4
#define	ID_AA64MMFR1_EL1_VMIDBITS_MASK		CONST64(0xf)
#define	ID_AA64MMFR1_EL1_HAFDBS_SHIFT		0
#define	ID_AA64MMFR1_EL1_HAFDBS_MASK		CONST64(0xf)

/*
 * AArch64 Memory Model Feature Register 2 fields
 */
#define	ID_AA64MMFR2_EL1_E0PD_SHIFT		60
#define	ID_AA64MMFR2_EL1_E0PD_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_EVT_SHIFT		56
#define	ID_AA64MMFR2_EL1_EVT_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_BBM_SHIFT		52
#define	ID_AA64MMFR2_EL1_BBM_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_TTL_SHIFT		48
#define	ID_AA64MMFR2_EL1_TTL_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_FWB_SHIFT		40
#define	ID_AA64MMFR2_EL1_FWB_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_IDS_SHIFT		36
#define	ID_AA64MMFR2_EL1_IDS_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_AT_SHIFT		32
#define	ID_AA64MMFR2_EL1_AT_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_ST_SHIFT		28
#define	ID_AA64MMFR2_EL1_ST_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_NV_SHIFT		24
#define	ID_AA64MMFR2_EL1_NV_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_CCIDX_SHIFT		20
#define	ID_AA64MMFR2_EL1_CCIDX_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_VARANGE_SHIFT		16
#define	ID_AA64MMFR2_EL1_VARANGE_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_IESB_SHIFT		12
#define	ID_AA64MMFR2_EL1_IESB_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_LSM_SHIFT		8
#define	ID_AA64MMFR2_EL1_LSM_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_UAO_SHIFT		4
#define	ID_AA64MMFR2_EL1_UAO_MASK		CONST64(0xf)
#define	ID_AA64MMFR2_EL1_CNP_SHIFT		0
#define	ID_AA64MMFR2_EL1_CNP_MASK		CONST64(0xf)

/*
 * AArch64 Processor Feature Register 0 fields
 */
#define	ID_AA64PFR0_EL1_CSV3_SHIFT		60
#define	ID_AA64PFR0_EL1_CSV3_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_CSV2_SHIFT		56
#define	ID_AA64PFR0_EL1_CSV2_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_DIT_SHIFT		48
#define	ID_AA64PFR0_EL1_DIT_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_AMU_SHIFT		44
#define	ID_AA64PFR0_EL1_AMU_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_MPAM_SHIFT		40
#define	ID_AA64PFR0_EL1_MPAM_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_SEL2_SHIFT		36
#define	ID_AA64PFR0_EL1_SEL2_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_SVE_SHIFT		32
#define	ID_AA64PFR0_EL1_SVE_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_RAS_SHIFT		28
#define	ID_AA64PFR0_EL1_RAS_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_GIC_SHIFT		24
#define	ID_AA64PFR0_EL1_GIC_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_ADVSIMD_SHIFT		20
#define	ID_AA64PFR0_EL1_ADVSIMD_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_FP_SHIFT		16
#define	ID_AA64PFR0_EL1_FP_MASK			CONST64(0xf)
#define	ID_AA64PFR0_EL1_EL3_SHIFT		12
#define	ID_AA64PFR0_EL1_EL3_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_EL2_SHIFT		8
#define	ID_AA64PFR0_EL1_EL2_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_EL1_SHIFT		4
#define	ID_AA64PFR0_EL1_EL1_MASK		CONST64(0xf)
#define	ID_AA64PFR0_EL1_EL0_SHIFT		0
#define	ID_AA64PFR0_EL1_EL0_MASK		CONST64(0xf)

/*
 * AArch64 Processor Feature Register 1 fields
 */
#define	ID_AA64PFR1_EL1_CSV2_FRAC_SHIFT		32
#define	ID_AA64PFR1_EL1_CSV2_FRAC_MASK		CONST64(0xf)
#define	ID_AA64PFR1_EL1_MPAM_FRAC_SHIFT		16
#define	ID_AA64PFR1_EL1_MPAM_FRAC_MASK		CONST64(0xf)
#define	ID_AA64PFR1_EL1_RAS_FRAC_SHIFT		12
#define	ID_AA64PFR1_EL1_RAS_FRAC_MASK		CONST64(0xf)
#define	ID_AA64PFR1_EL1_MTE_SHIFT		8
#define	ID_AA64PFR1_EL1_MTE_MASK		CONST64(0xf)
#define	ID_AA64PFR1_EL1_SSBS_SHIFT		4
#define	ID_AA64PFR1_EL1_SSBS_MASK		CONST64(0xf)
#define	ID_AA64PFR1_EL1_BT_SHIFT		0
#define	ID_AA64PFR1_EL1_BT_MASK			CONST64(0xf)

/*
 * AArch64 Debug Feature Register 0
 */
#define	ID_AA64DFR0_EL1_MTPMU_SHIFT		48
#define	ID_AA64DFR0_EL1_MTPMU_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_TRACEFILT_SHIFT		40
#define	ID_AA64DFR0_EL1_TRACEFILT_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_DOUBLELOCK_SHIFT	36
#define	ID_AA64DFR0_EL1_DOUBLELOCK_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_PMSVER_SHIFT		32
#define	ID_AA64DFR0_EL1_PMSVER_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_CTX_CMPS_SHIFT		28
#define	ID_AA64DFR0_EL1_CTX_CMPS_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_WRPS_SHIFT		20
#define	ID_AA64DFR0_EL1_WRPS_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_BRPS_SHIFT		12
#define	ID_AA64DFR0_EL1_BRPS_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_PMUVER_SHIFT		8
#define	ID_AA64DFR0_EL1_PMUVER_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_TRACEVER_SHIFT		4
#define	ID_AA64DFR0_EL1_TRACEVER_MASK		CONST64(0xf)
#define	ID_AA64DFR0_EL1_DEBUGVER_SHIFT		0
#define	ID_AA64DFR0_EL1_DEBUGVER_MASK		CONST64(0xf)

/*
 * AArch64 Debug Feature Register 1
 * [63:0] is RES0
 */

/*
 * AArch64 Instruction Set Attribute Register 0
 */
#define	ID_AA64ISAR0_EL1_RNDR_SHIFT		60
#define	ID_AA64ISAR0_EL1_RNDR_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_TLB_SHIFT		56
#define	ID_AA64ISAR0_EL1_TLB_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_TS_SHIFT		52
#define	ID_AA64ISAR0_EL1_TS_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_FHM_SHIFT		48
#define	ID_AA64ISAR0_EL1_FHM_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_DP_SHIFT		44
#define	ID_AA64ISAR0_EL1_DP_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_SM4_SHIFT		40
#define	ID_AA64ISAR0_EL1_SM4_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_SM3_SHIFT		36
#define	ID_AA64ISAR0_EL1_SM3_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_SHA3_SHIFT		32
#define	ID_AA64ISAR0_EL1_SHA3_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_RDM_SHIFT		28
#define	ID_AA64ISAR0_EL1_RDM_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_ATOMIC_SHIFT		20
#define	ID_AA64ISAR0_EL1_ATOMIC_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_CRC32_SHIFT		16
#define	ID_AA64ISAR0_EL1_CRC32_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_SHA2_SHIFT		12
#define	ID_AA64ISAR0_EL1_SHA2_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_SHA1_SHIFT		8
#define	ID_AA64ISAR0_EL1_SHA1_MASK		CONST64(0xf)
#define	ID_AA64ISAR0_EL1_AES_SHIFT		4
#define	ID_AA64ISAR0_EL1_AES_MASK		CONST64(0xf)

/*
 * AArch64 Instruction Set Attribute Register 1
 */
#define	ID_AA64ISAR1_EL1_LS64_SHIFT		60
#define	ID_AA64ISAR1_EL1_LS64_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_XS_SHIFT		56
#define	ID_AA64ISAR1_EL1_XS_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_I8MM_SHIFT		52
#define	ID_AA64ISAR1_EL1_I8MM_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_DGH_SHIFT		48
#define	ID_AA64ISAR1_EL1_DGH_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_BF16_SHIFT		44
#define	ID_AA64ISAR1_EL1_BF16_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_SPECRES_SHIFT		40
#define	ID_AA64ISAR1_EL1_SPECRES_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_SB_SHIFT		36
#define	ID_AA64ISAR1_EL1_SB_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_FRINTTS_SHIFT		32
#define	ID_AA64ISAR1_EL1_FRINTTS_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_GPI_SHIFT		28
#define	ID_AA64ISAR1_EL1_GPI_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_GPA_SHIFT		24
#define	ID_AA64ISAR1_EL1_GPA_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_LRCPC_SHIFT		20
#define	ID_AA64ISAR1_EL1_LRCPC_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_FCMA_SHIFT		16
#define	ID_AA64ISAR1_EL1_FCMA_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_JSCVT_SHIFT		12
#define	ID_AA64ISAR1_EL1_JSCVT_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_API_SHIFT		8
#define	ID_AA64ISAR1_EL1_API_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_APA_SHIFT		4
#define	ID_AA64ISAR1_EL1_APA_MASK		CONST64(0xf)
#define	ID_AA64ISAR1_EL1_DPB_SHIFT		0
#define	ID_AA64ISAR1_EL1_DPB_MASK		CONST64(0xf)

/*
 * AArch64 Instruction Set Attribute Register 2
 */
#define	ID_AA64ISAR2_EL1_RPRES_SHIFT		4
#define	ID_AA64ISAR2_EL1_RPRES_MASK		CONST64(0xf)
#define	ID_AA64ISAR2_EL1_WFXT_SHIFT		0
#define	ID_AA64ISAR2_EL1_WFXT_MASK		CONST64(0xf)

#endif	/* _AARCH64_IDREGS_H */
